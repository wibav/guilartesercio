name: Deploy to Firebase Hosting

on:
    push:
        branches:
            - main
            - master
    pull_request:
        branches:
            - main
            - master

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Setup Node.js
              uses: actions/setup-node@v3
              with:
                  node-version: "18"
                  cache: "yarn"

            - name: Install dependencies
              run: yarn install --frozen-lockfile

            - name: Build project
              run: yarn build

            - name: Deploy to Firebase Hosting
              if: github.event_name == 'push' && github.ref == 'refs/heads/main'
              uses: FirebaseExtended/action-hosting-deploy@v0
              with:
                  repoToken: "${{ secrets.GITHUB_TOKEN }}"
                  firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT }}"
                  channelId: live
                  projectId: ${{ secrets.FIREBASE_PROJECT_ID }}

            - name: Post PR comment
              if: github.event_name == 'pull_request'
              uses: actions/github-script@v6
              with:
                  script: |
                      github.rest.issues.createComment({
                        issue_number: context.issue.number,
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        body: 'âœ… Build completado correctamente. Preview disponible en el comentario de Firebase.'
                      })
